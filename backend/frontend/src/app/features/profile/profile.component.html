<div class="profile-container">
  <div class="container">
    <div class="page-header">
      <h1>Mon Profil</h1>
      <div class="profile-actions">
        <button 
          *ngIf="!isEditing" 
          class="btn btn-primary" 
          (click)="toggleEdit()"
        >
          Modifier le profil
        </button>
        <div *ngIf="isEditing" class="edit-actions">
          <button 
            class="btn btn-success" 
            (click)="saveProfile()"
            [disabled]="profileForm.invalid || isSaving"
          >
            <span *ngIf="!isSaving">Sauvegarder</span>
            <span *ngIf="isSaving">Sauvegarde...</span>
          </button>
          <button 
            class="btn btn-secondary" 
            (click)="cancelEdit()"
            [disabled]="isSaving"
          >
            Annuler
          </button>
        </div>
      </div>
    </div>

    <div class="profile-content" *ngIf="currentUser">
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar">
            {{ currentUser.firstName.charAt(0) }}{{ currentUser.lastName.charAt(0) }}
          </div>
          <div class="profile-info">
            <h2>{{ currentUser.firstName }} {{ currentUser.lastName }}</h2>
            <p class="user-role">{{ getUserRole() }}</p>
            <p class="user-status" [class]="currentUser.isActive ? 'status-active' : 'status-inactive'">
              {{ currentUser.isActive ? 'Actif' : 'Inactif' }}
            </p>
          </div>
        </div>

        <div class="profile-form">
          <form [formGroup]="profileForm" *ngIf="isEditing; else readOnlyView">
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">Prénom</label>
                <input
                  type="text"
                  id="firstName"
                  formControlName="firstName"
                  class="form-control"
                  [class.error]="getFieldError('firstName')"
                >
                <div class="error-message" *ngIf="getFieldError('firstName')">
                  {{ getFieldError('firstName') }}
                </div>
              </div>

              <div class="form-group">
                <label for="lastName">Nom</label>
                <input
                  type="text"
                  id="lastName"
                  formControlName="lastName"
                  class="form-control"
                  [class.error]="getFieldError('lastName')"
                >
                <div class="error-message" *ngIf="getFieldError('lastName')">
                  {{ getFieldError('lastName') }}
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                class="form-control"
                [class.error]="getFieldError('email')"
              >
              <div class="error-message" *ngIf="getFieldError('email')">
                {{ getFieldError('email') }}
              </div>
            </div>

            <div class="form-group">
              <label for="username">Nom d'utilisateur</label>
              <input
                type="text"
                id="username"
                formControlName="username"
                class="form-control"
                [class.error]="getFieldError('username')"
              >
              <div class="error-message" *ngIf="getFieldError('username')">
                {{ getFieldError('username') }}
              </div>
            </div>
          </form>

          <ng-template #readOnlyView>
            <div class="profile-details">
              <div class="detail-row">
                <label>Prénom:</label>
                <span>{{ currentUser.firstName }}</span>
              </div>
              <div class="detail-row">
                <label>Nom:</label>
                <span>{{ currentUser.lastName }}</span>
              </div>
              <div class="detail-row">
                <label>Email:</label>
                <span>{{ currentUser.email }}</span>
              </div>
              <div class="detail-row">
                <label>Nom d'utilisateur:</label>
                <span>{{ currentUser.username }}</span>
              </div>
              <div class="detail-row">
                <label>Rôle:</label>
                <span>{{ getUserRole() }}</span>
              </div>
              <div class="detail-row">
                <label>Membre depuis:</label>
                <span>{{ getFormattedDate(currentUser.createdAt) }}</span>
              </div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
